<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiENKoR TERMINAL v2.4.7</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0e1a;
            --bg-light: #f0f4f8;
            --primary-dark: #7bed9f;
            --primary-light: #2ecc71;
            --secondary-dark: #c77dff;
            --secondary-light: #9d4edd;
            --text-dark: #e0e0e0;
            --text-light: #1a1a1a;
            --neon-green: #7bed9f;
            --neon-purple: #c77dff;
            --panel-dark: #151b2e;
            --panel-light: #ffffff;
            --border-dark: #2a3f5f;
            --border-light: #cbd5e0;
        }

        body {
            font-family: 'Courier New', monospace;
            background: var(--bg-dark);
            color: var(--text-dark);
            overflow-x: hidden;
            transition: background 0.3s, color 0.3s;
        }

        body.light-mode {
            background: var(--bg-light);
            color: var(--text-light);
        }

        body.light-mode .boot-screen,
        body.light-mode .main-interface {
            background: var(--bg-light);
        }

        body.light-mode .terminal-line,
        body.light-mode .system-info,
        body.light-mode h1, body.light-mode h2, body.light-mode h3 {
            color: var(--text-light);
        }

        body.light-mode .neon-text {
            color: var(--primary-light);
            text-shadow: 0 0 10px var(--primary-light);
        }

        body.light-mode .panel {
            background: var(--panel-light);
            border-color: var(--border-light);
        }

        body.light-mode .btn {
            background: var(--panel-light);
            border-color: var(--border-light);
            color: var(--text-light);
        }

        body.light-mode .btn:hover {
            background: var(--primary-light);
            color: white;
        }

        body.light-mode .chat-message.user {
            background: var(--panel-light);
            border-color: var(--border-light);
        }

        body.light-mode .chat-message.system {
            background: #e8f5e9;
            border-color: var(--primary-light);
        }

        body.light-mode .rule-item {
            background: var(--panel-light);
            border-color: var(--border-light);
        }

        .boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: var(--bg-dark);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .boot-screen.hidden {
            animation: fadeOut 0.5s forwards;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                visibility: hidden;
            }
        }

        .terminal-line {
            font-size: 14px;
            margin: 4px 0;
            color: var(--neon-green);
            opacity: 0;
            animation: typeIn 0.3s forwards;
        }

        @keyframes typeIn {
            to { opacity: 1; }
        }

        .cursor {
            display: inline-block;
            width: 10px;
            height: 16px;
            background: var(--neon-green);
            animation: blink 1s infinite;
            margin-left: 5px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .main-interface {
            display: none;
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
            position: relative;
        }

        .main-interface.active {
            display: block;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--neon-green);
            text-shadow: 0 0 20px var(--neon-green);
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--panel-dark);
            border: 2px solid var(--border-dark);
            color: var(--text-dark);
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .btn:hover {
            background: var(--neon-green);
            color: var(--bg-dark);
            box-shadow: 0 0 15px var(--neon-green);
        }

        .btn.active {
            background: var(--neon-purple);
            border-color: var(--neon-purple);
            box-shadow: 0 0 15px var(--neon-purple);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: var(--panel-dark);
            border: 2px solid var(--border-dark);
            padding: 20px;
            position: relative;
            transition: all 0.3s;
            display: none;
        }

        .panel.active {
            display: block;
        }

        .panel:hover {
            border-color: var(--neon-green);
            box-shadow: 0 0 20px rgba(123, 237, 159, 0.3);
        }

        .panel h2 {
            color: var(--neon-purple);
            margin-bottom: 15px;
            font-size: 18px;
            text-shadow: 0 0 10px var(--neon-purple);
        }

        .clearance-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--neon-purple);
            color: var(--bg-dark);
            padding: 4px 8px;
            font-size: 10px;
            font-weight: bold;
        }

        .system-info {
            font-size: 12px;
            line-height: 1.6;
            color: var(--text-dark);
        }

        .classified {
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(199, 125, 255, 0.1) 10px,
                rgba(199, 125, 255, 0.1) 20px
            );
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid var(--neon-purple);
        }

        .glitch {
            position: relative;
            animation: glitch 3s infinite;
        }

        @keyframes glitch {
            0%, 90%, 100% {
                transform: translate(0);
            }
            92% {
                transform: translate(-2px, 2px);
            }
            94% {
                transform: translate(2px, -2px);
            }
            96% {
                transform: translate(-2px, -2px);
            }
        }

        .neon-text {
            color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green);
        }

        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--panel-dark);
            border-top: 2px solid var(--border-dark);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            z-index: 100;
            flex-wrap: wrap;
            gap: 10px;
        }

        body.light-mode .status-bar {
            background: var(--panel-light);
            border-color: var(--border-light);
        }

        .hidden-console {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            background: rgba(10, 14, 26, 0.98);
            border: 3px solid var(--neon-purple);
            padding: 20px;
            z-index: 10000;
            overflow-y: auto;
            box-shadow: 0 0 50px var(--neon-purple);
        }

        .hidden-console.active {
            display: block;
            animation: glitchIn 0.5s;
        }

        @keyframes glitchIn {
            0%, 20%, 40%, 60%, 80%, 100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            10%, 30%, 50%, 70%, 90% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(1.02);
            }
        }

        .console-header {
            color: var(--neon-purple);
            margin-bottom: 20px;
            font-size: 16px;
            text-shadow: 0 0 15px var(--neon-purple);
        }

        .console-content {
            font-size: 13px;
            line-height: 1.8;
        }

        .redacted {
            background: var(--text-dark);
            color: var(--text-dark);
            cursor: not-allowed;
            user-select: none;
        }

        .warning {
            color: #ff6b6b;
            text-shadow: 0 0 10px #ff6b6b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .close-console {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--neon-purple);
            font-size: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        .chat-container {
            background: var(--panel-dark);
            border: 2px solid var(--border-dark);
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 15px;
            scroll-behavior: smooth;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 4px;
        }

        .chat-message.user {
            background: rgba(42, 63, 95, 0.5);
            border-left: 3px solid var(--neon-green);
        }

        .chat-message.system {
            background: rgba(21, 27, 46, 0.5);
            border-left: 3px solid var(--neon-purple);
        }

        .chat-message.reasoning {
            background: rgba(199, 125, 255, 0.1);
            border-left: 3px solid var(--neon-purple);
            font-size: 11px;
            opacity: 0.8;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            background: var(--panel-dark);
            border: 2px solid var(--border-dark);
            color: var(--text-dark);
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        body.light-mode .chat-input {
            background: var(--panel-light);
            border-color: var(--border-light);
            color: var(--text-light);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--neon-green);
            box-shadow: 0 0 10px rgba(123, 237, 159, 0.3);
        }

        .rule-item {
            background: var(--panel-dark);
            border: 1px solid var(--border-dark);
            padding: 10px;
            margin-bottom: 10px;
            font-size: 11px;
            transition: all 0.3s;
        }

        .rule-item:hover {
            border-color: var(--neon-green);
        }

        .rule-condition {
            color: var(--neon-green);
            margin-bottom: 5px;
        }

        .rule-action {
            color: var(--neon-purple);
        }

        .inference-graph {
            background: var(--panel-dark);
            border: 2px solid var(--border-dark);
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-size: 11px;
        }

        .graph-node {
            padding: 5px 10px;
            margin: 5px 0;
            border-left: 2px solid var(--neon-green);
            transition: all 0.3s;
        }

        .graph-node:hover {
            background: rgba(123, 237, 159, 0.1);
        }

        .graph-node.fired {
            border-left-color: var(--neon-purple);
            background: rgba(199, 125, 255, 0.1);
        }

        .knowledge-editor {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .knowledge-editor input,
        .knowledge-editor textarea {
            background: var(--panel-dark);
            border: 2px solid var(--border-dark);
            color: var(--text-dark);
            padding: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        body.light-mode .knowledge-editor input,
        body.light-mode .knowledge-editor textarea {
            background: var(--panel-light);
            border-color: var(--border-light);
            color: var(--text-light);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .stat-box {
            background: rgba(123, 237, 159, 0.1);
            border: 1px solid var(--neon-green);
            padding: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            color: var(--neon-green);
            font-weight: bold;
        }

        .stat-label {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .terminal-line {
                font-size: 12px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                font-size: 10px;
            }

            .chat-container {
                height: 300px;
            }
        }

        .scan-line {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, transparent, var(--neon-green), transparent);
            animation: scan 4s linear infinite;
            pointer-events: none;
            z-index: 9998;
            opacity: 0.3;
        }

        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }

        .mission-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--neon-green), var(--neon-purple));
            padding: 2px 8px;
            font-size: 10px;
            margin: 5px 5px 5px 0;
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .suggestion-box {
            background: rgba(199, 125, 255, 0.1);
            border: 1px solid var(--neon-purple);
            padding: 10px;
            margin-top: 10px;
            font-size: 11px;
        }

        .suggestion-item {
            cursor: pointer;
            padding: 5px;
            transition: all 0.3s;
        }

        .suggestion-item:hover {
            background: rgba(199, 125, 255, 0.2);
            padding-left: 10px;
        }

        .knowledge-graph {
            background: var(--panel-dark);
            border: 2px solid var(--border-dark);
            padding: 15px;
            height: 400px;
            overflow: auto;
            position: relative;
        }

        .graph-svg {
            width: 100%;
            height: 100%;
            min-height: 400px;
        }

        .graph-node-circle {
            cursor: pointer;
            transition: all 0.3s;
        }

        .graph-node-circle:hover {
            filter: brightness(1.5);
        }

        .graph-link {
            stroke: var(--border-dark);
            stroke-width: 2;
            fill: none;
            opacity: 0.6;
        }

        .graph-link.active {
            stroke: var(--neon-purple);
            opacity: 1;
            animation: flowAnimation 2s infinite;
        }

        @keyframes flowAnimation {
            0%, 100% { stroke-dashoffset: 0; }
            50% { stroke-dashoffset: 10; }
        }

        .graph-text {
            fill: var(--text-dark);
            font-size: 11px;
            pointer-events: none;
        }

        body.light-mode .graph-text {
            fill: var(--text-light);
        }

        .auto-save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(123, 237, 159, 0.9);
            color: var(--bg-dark);
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 11px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.03;
        }

        .easter-egg-found {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(199, 125, 255, 0.95);
            color: white;
            padding: 30px;
            border: 3px solid var(--neon-green);
            z-index: 10001;
            text-align: center;
            animation: eggPop 0.5s forwards;
            box-shadow: 0 0 50px var(--neon-purple);
        }

        @keyframes eggPop {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
            50% { transform: translate(-50%, -50%) scale(1.2) rotate(10deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
        }

        .glitch-text {
            position: relative;
        }

        .glitch-text::before,
        .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .glitch-text::before {
            left: 2px;
            text-shadow: -2px 0 var(--neon-green);
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim 3s infinite linear alternate-reverse;
        }

        .glitch-text::after {
            left: -2px;
            text-shadow: -2px 0 var(--neon-purple);
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim 2s infinite linear alternate-reverse;
        }

        @keyframes glitch-anim {
            0% { clip: rect(61px, 9999px, 85px, 0); }
            20% { clip: rect(18px, 9999px, 54px, 0); }
            40% { clip: rect(107px, 9999px, 29px, 0); }
            60% { clip: rect(45px, 9999px, 93px, 0); }
            80% { clip: rect(72px, 9999px, 11px, 0); }
            100% { clip: rect(34px, 9999px, 68px, 0); }
        }
    </style>
</head>
<body>
    <div class="scan-line"></div>
    <canvas class="matrix-bg" id="matrixCanvas"></canvas>
    <div class="auto-save-indicator" id="autoSaveIndicator">üíæ Sauvegarde automatique...</div>
    
    <div class="boot-screen" id="bootScreen">
        <div id="bootContent"></div>
    </div>

    <div class="main-interface" id="mainInterface">
        <div class="header">
            <div class="logo glitch">BiENKoR EXPERT SYSTEM</div>
            <div class="controls">
                <button class="btn active" id="viewDashboard">TABLEAU DE BORD</button>
                <button class="btn" id="viewExpert">SYST√àME EXPERT</button>
                <button class="btn" id="viewKnowledge">BASE CONNAISSANCES</button>
                <button class="btn" id="themeToggle">MODE CLAIR</button>
                <button class="btn" id="clearanceBtn">CLEARANCE: GUEST</button>
            </div>
        </div>

        <!-- DASHBOARD VIEW -->
        <div id="dashboardView" class="view-container active">
            <div class="grid">
                <div class="panel active">
                    <div class="clearance-badge">PUBLIC</div>
                    <h2>STATISTIQUES SYST√àME</h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="statRules">0</div>
                            <div class="stat-label">R√àGLES</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="statFacts">0</div>
                            <div class="stat-label">FAITS</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="statInferences">0</div>
                            <div class="stat-label">INF√âRENCES</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="statQueries">0</div>
                            <div class="stat-label">REQU√äTES</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <div class="mission-tag">MISSION: KORBEN</div>
                        <div class="mission-tag">IA: ACTIVE</div>
                    </div>
                </div>

                <div class="panel active">
                    <div class="clearance-badge">PUBLIC</div>
                    <h2>HI√âRARCHIE</h2>
                    <div class="system-info">
                        <p><span class="neon-text">NIVEAU 4:</span> <span class="redacted">CR√âATEUR</span></p>
                        <p style="font-size: 10px; margin-left: 20px; opacity: 0.7;">‚îî‚îÄ Prot√©g√© par Agent Gardien</p>
                        <p><span class="neon-text">NIVEAU 3:</span> Le Collectif</p>
                        <p><span class="neon-text">NIVEAU 2:</span> L'Organisation</p>
                        <p><span class="neon-text">NIVEAU 1:</span> Agents</p>
                    </div>
                </div>

                <div class="panel active">
                    <div class="clearance-badge">RESTREINT</div>
                    <h2>AGENT GARDIEN</h2>
                    <div class="system-info classified">
                        <p><span class="neon-text">STATUT:</span> <span id="guardianStatus">ACTIF</span></p>
                        <p><span class="neon-text">INTERVENTIONS:</span> <span id="guardianInterventions">3247</span></p>
                        <p><span class="neon-text">DERNI√àRE ACTION:</span> <span id="guardianLastAction">Surveillance</span></p>
                    </div>
                </div>

                <div class="panel active">
                    <div class="clearance-badge">PUBLIC</div>
                    <h2>INF√âRENCES R√âCENTES</h2>
                    <div class="inference-graph" id="recentInferences">
                        <p style="opacity: 0.5;">Aucune inf√©rence r√©cente...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- EXPERT SYSTEM VIEW -->
        <div id="expertView" class="view-container">
            <div class="grid">
                <div class="panel" style="display: block; grid-column: 1 / -1;">
                    <h2>CONSOLE D'INTERROGATION</h2>
                    <div class="chat-container" id="chatContainer"></div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="queryInput" placeholder="Posez votre question au syst√®me expert...">
                        <button class="btn" id="querySubmit">ENVOYER</button>
                    </div>
                    <div class="suggestion-box">
                        <strong style="color: var(--neon-purple);">Suggestions:</strong>
                        <div class="suggestion-item" data-query="Quel agent pour mission infiltration ?">‚Üí Quel agent pour mission infiltration ?</div>
                        <div class="suggestion-item" data-query="√âvaluer menace niveau 3">‚Üí √âvaluer menace niveau 3</div>
                        <div class="suggestion-item" data-query="Agent X fiable pour mission Y ?">‚Üí Agent X fiable pour mission Y ?</div>
                        <div class="suggestion-item" data-query="Analyser activit√© suspecte">‚Üí Analyser activit√© suspecte</div>
                    </div>
                </div>

                <div class="panel" style="display: block;">
                    <h2>TRACE DE RAISONNEMENT</h2>
                    <div class="inference-graph" id="reasoningTrace">
                        <p style="opacity: 0.5;">Le raisonnement appara√Ætra ici...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- KNOWLEDGE BASE VIEW -->
        <div id="knowledgeView" class="view-container">
            <div class="grid">
                <div class="panel" style="display: block; grid-column: 1 / -1;">
                    <h2>R√àGLES ACTIVES</h2>
                    <div style="max-height: 400px; overflow-y: auto;" id="rulesContainer"></div>
                </div>

                <div class="panel" style="display: block;">
                    <div class="clearance-badge">SUPERVISEUR</div>
                    <h2>AJOUTER R√àGLE</h2>
                    <div class="knowledge-editor">
                        <input type="text" id="ruleCondition" placeholder="Condition (ex: agent.experience > 5)">
                        <input type="text" id="ruleAction" placeholder="Action (ex: agent.rank = senior)">
                        <button class="btn" id="addRuleBtn">AJOUTER R√àGLE</button>
                    </div>
                </div>

                <div class="panel" style="display: block;">
                    <div class="clearance-badge">PUBLIC</div>
                    <h2>EXPORT / IMPORT</h2>
                    <div class="knowledge-editor">
                        <button class="btn" id="exportHtmlBtn">‚¨á EXPORT HTML</button>
                        <button class="btn" id="exportMdBtn">‚¨á EXPORT MD</button>
                        <button class="btn" id="exportJsonBtn">‚¨á EXPORT JSON</button>
                        <button class="btn" id="importJsonBtn">‚¨Ü IMPORT JSON</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                    </div>
                </div>

                <div class="panel" style="display: block;">
                    <h2>FAITS CONNUS</h2>
                    <div style="max-height: 300px; overflow-y: auto; font-size: 11px;" id="factsContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <span>BiENKoR v2.4.7</span>
        <span id="currentTime"></span>
        <span>CLEARANCE: <span id="statusClearance">GUEST</span></span>
        <span id="engineStatus">MOTEUR: <span class="neon-text">ACTIF</span></span>
        <span id="easterEggCounter" style="opacity: 0;">ü•ö 0</span>
    </div>

    <div class="hidden-console" id="hiddenConsole">
        <button class="close-console" id="closeConsole">√ó</button>
        <div class="console-header">
            ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê<br>
            CONSOLE DE NIVEAU SUP√âRIEUR<br>
            ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        </div>
        <div class="console-content" id="consoleContent"></div>
    </div>

    <script>
        // ========== EXPERT SYSTEM ENGINE ==========
        class ExpertSystem {
            constructor() {
                this.rules = [];
                this.facts = {};
                this.inferenceHistory = [];
                this.queryCount = 0;
            }

            addRule(condition, action, description = '', clearance = 0) {
                this.rules.push({
                    id: this.rules.length,
                    condition,
                    action,
                    description,
                    clearance,
                    fired: false
                });
            }

            addFact(key, value) {
                this.facts[key] = value;
            }

            evaluateCondition(condition) {
                try {
                    const func = new Function('facts', `with(facts) { return ${condition}; }`);
                    return func(this.facts);
                } catch (e) {
                    return false;
                }
            }

            executeAction(action) {
                try {
                    const func = new Function('facts', `with(facts) { ${action}; return facts; }`);
                    this.facts = func(this.facts);
                } catch (e) {
                    console.error('Action execution error:', e);
                }
            }

            forwardChaining(maxIterations = 100) {
                let iteration = 0;
                let changed = true;
                const trace = [];

                while (changed && iteration < maxIterations) {
                    changed = false;
                    iteration++;

                    for (let rule of this.rules) {
                        if (!rule.fired && this.evaluateCondition(rule.condition)) {
                            this.executeAction(rule.action);
                            rule.fired = true;
                            changed = true;

                            const inference = {
                                iteration,
                                rule: rule.id,
                                description: rule.description,
                                condition: rule.condition,
                                action: rule.action,
                                timestamp: new Date()
                            };
                            trace.push(inference);
                            this.inferenceHistory.push(inference);
                        }
                    }
                }

                return trace;
            }

            backwardChaining(goal) {
                // Simplified backward chaining
                const trace = [`Recherche de: ${goal}`];
                
                for (let rule of this.rules) {
                    if (rule.action.includes(goal)) {
                        trace.push(`R√®gle trouv√©e: ${rule.description}`);
                        trace.push(`Condition: ${rule.condition}`);
                        
                        if (this.evaluateCondition(rule.condition)) {
                            trace.push(`‚úì Condition satisfaite`);
                            this.executeAction(rule.action);
                            return { success: true, trace };
                        } else {
                            trace.push(`‚úó Condition non satisfaite`);
                        }
                    }
                }
                
                return { success: false, trace };
            }

            query(question) {
                this.queryCount++;
                const lowerQ = question.toLowerCase();
                const response = {
                    answer: '',
                    reasoning: [],
                    success: false
                };

                // Pattern matching pour questions
                if (lowerQ.includes('agent') && lowerQ.includes('infiltration')) {
                    this.addFact('mission.type', 'infiltration');
                    const trace = this.forwardChaining();
                    response.reasoning = trace;
                    
                    if (this.facts['recommended.agent']) {
                        response.answer = `Agent recommand√©: ${this.facts['recommended.agent']}. ${this.facts['recommendation.reason'] || ''}`;
                        response.success = true;
                    } else {
                        response.answer = "Aucun agent qualifi√© trouv√© pour cette mission.";
                    }
                }
                else if (lowerQ.includes('menace') || lowerQ.includes('risque')) {
                    this.addFact('analysis.type', 'threat');
                    const trace = this.forwardChaining();
                    response.reasoning = trace;
                    
                    response.answer = `Niveau de menace √©valu√©: ${this.facts['threat.level'] || 'Ind√©termin√©'}. ${this.facts['threat.details'] || ''}`;
                    response.success = true;
                }
                else if (lowerQ.includes('fiable') || lowerQ.includes('confiance')) {
                    this.addFact('query.type', 'trust');
                    const trace = this.forwardChaining();
                    response.reasoning = trace;
                    
                    response.answer = `√âvaluation de confiance: ${this.facts['trust.level'] || 'En cours...'}`;
                    response.success = true;
                }
                else if (lowerQ.includes('cr√©ateur') || lowerQ.includes('niveau 4')) {
                    incrementGuardianInterventions();
                    response.answer = "‚ö† ACC√àS REFUS√â - Agent Gardien: Cette information est classifi√©e au plus haut niveau.";
                    response.reasoning = [{description: 'Intervention Agent Gardien - Blocage acc√®s Niveau 4'}];
                    response.success = false;
                }
                else {
                    const trace = this.forwardChaining();
                    response.reasoning = trace;
                    response.answer = `Analyse effectu√©e. ${trace.length} r√®gles activ√©es. Consultez la trace de raisonnement pour plus de d√©tails.`;
                    response.success = true;
                }

                return response;
            }

            reset() {
                this.rules.forEach(r => r.fired = false);
            }

            exportKnowledge() {
                return JSON.stringify({
                    rules: this.rules,
                    facts: this.facts
                }, null, 2);
            }

            importKnowledge(json) {
                try {
                    const data = JSON.parse(json);
                    this.rules = data.rules || [];
                    this.facts = data.facts || {};
                    return true;
                } catch (e) {
                    return false;
                }
            }
        }

        // ========== INITIALIZATION ==========
        const expertSystem = new ExpertSystem();
        let clearanceLevel = 0;
        let easterEggs = 0;
        let konamiCode = [];
        const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let autoSaveInterval = null;
        let secretCommands = {
            'matrix': false,
            'korben': false,
            'creator': false,
            'guardian': false,
            '42': false,
            'ghost': false,
            'omniscient': false
        };

        // ========== AUTO-SAVE SYSTEM ==========
        async function autoSave() {
            try {
                const saveData = {
                    rules: expertSystem.rules,
                    facts: expertSystem.facts,
                    inferenceHistory: expertSystem.inferenceHistory.slice(-100),
                    clearanceLevel: clearanceLevel,
                    easterEggs: easterEggs,
                    secretCommands: secretCommands,
                    timestamp: new Date().toISOString()
                };

                await window.storage.set('BiENKoR_autosave', JSON.stringify(saveData));
                showAutoSaveIndicator();
            } catch (e) {
                console.log('Auto-save failed (storage not available):', e);
            }
        }

        async function loadAutoSave() {
            try {
                const result = await window.storage.get('BiENKoR_autosave');
                if (result && result.value) {
                    const data = JSON.parse(result.value);
                    expertSystem.rules = data.rules || expertSystem.rules;
                    expertSystem.facts = data.facts || expertSystem.facts;
                    expertSystem.inferenceHistory = data.inferenceHistory || [];
                    clearanceLevel = data.clearanceLevel || 0;
                    easterEggs = data.easterEggs || 0;
                    secretCommands = data.secretCommands || secretCommands;
                    
                    if (easterEggs > 0) {
                        document.getElementById('easterEggCounter').style.opacity = '1';
                        document.getElementById('easterEggCounter').textContent = 'ü•ö ' + easterEggs;
                    }
                    
                    updateClearanceDisplay();
                    return true;
                }
            } catch (e) {
                console.log('Auto-load failed:', e);
            }
            return false;
        }

        function showAutoSaveIndicator() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }

        function updateClearanceDisplay() {
            const levels = ['GUEST', 'AGENT', 'OP√âRATEUR', 'SUPERVISEUR', 'DIRECTEUR'];
            document.getElementById('clearanceBtn').textContent = 'CLEARANCE: ' + levels[clearanceLevel];
            document.getElementById('statusClearance').textContent = levels[clearanceLevel];
        }

        // ========== KNOWLEDGE GRAPH VISUALIZATION ==========
        function generateKnowledgeGraph() {
            const svg = document.getElementById('knowledgeGraphSvg');
            const width = svg.clientWidth || 800;
            const height = svg.clientHeight || 400;
            
            svg.innerHTML = '';
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            const nodes = [];
            const links = [];

            // Create central node for facts
            nodes.push({
                id: 'facts',
                label: 'FAITS',
                x: width / 2,
                y: height / 2,
                type: 'central',
                color: '#7bed9f'
            });

            // Create nodes for top facts
            let factIndex = 0;
            for (let [key, value] of Object.entries(expertSystem.facts).slice(0, 8)) {
                const angle = (factIndex / 8) * 2 * Math.PI;
                const radius = 120;
                nodes.push({
                    id: `fact_${factIndex}`,
                    label: key.split('.').pop().substring(0, 10),
                    x: width / 2 + Math.cos(angle) * radius,
                    y: height / 2 + Math.sin(angle) * radius,
                    type: 'fact',
                    color: '#c77dff',
                    fullLabel: `${key}: ${value}`
                });
                links.push({ source: 'facts', target: `fact_${factIndex}` });
                factIndex++;
            }

            // Create nodes for active rules
            expertSystem.rules.slice(0, 6).forEach((rule, i) => {
                if (rule.fired) {
                    const angle = (i / 6) * 2 * Math.PI + Math.PI / 6;
                    const radius = 180;
                    nodes.push({
                        id: `rule_${i}`,
                        label: `R${i + 1}`,
                        x: width / 2 + Math.cos(angle) * radius,
                        y: height / 2 + Math.sin(angle) * radius,
                        type: 'rule',
                        color: '#ff6b6b',
                        fullLabel: rule.description
                    });
                    links.push({ source: 'facts', target: `rule_${i}`, active: true });
                }
            });

            // Draw links
            links.forEach(link => {
                const source = nodes.find(n => n.id === link.source);
                const target = nodes.find(n => n.id === link.target);
                if (source && target) {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', source.x);
                    line.setAttribute('y1', source.y);
                    line.setAttribute('x2', target.x);
                    line.setAttribute('y2', target.y);
                    line.setAttribute('class', link.active ? 'graph-link active' : 'graph-link');
                    if (link.active) {
                        line.setAttribute('stroke-dasharray', '5,5');
                    }
                    svg.appendChild(line);
                }
            });

            // Draw nodes
            nodes.forEach(node => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', node.x);
                circle.setAttribute('cy', node.y);
                circle.setAttribute('r', node.type === 'central' ? 25 : 15);
                circle.setAttribute('fill', node.color);
                circle.setAttribute('class', 'graph-node-circle');
                circle.setAttribute('opacity', '0.8');
                
                const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                title.textContent = node.fullLabel || node.label;
                circle.appendChild(title);
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y + (node.type === 'central' ? 35 : 25));
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('class', 'graph-text');
                text.textContent = node.label;
                
                g.appendChild(circle);
                g.appendChild(text);
                svg.appendChild(g);
            });
        }

        // ========== EASTER EGGS SYSTEM ==========
        function checkSecretCommand(query) {
            const lowerQ = query.toLowerCase();
            let found = null;

            if (lowerQ.includes('matrix') && !secretCommands.matrix) {
                secretCommands.matrix = true;
                found = {
                    title: 'EASTER EGG: MATRIX',
                    message: 'Vous avez d√©couvert l\'effet Matrix ! Le fond anim√© s\'active...',
                    reward: 'Effet visuel Matrix d√©bloqu√©'
                };
                startMatrixRain();
            }
            else if (lowerQ.includes('42') && !secretCommands['42']) {
                secretCommands['42'] = true;
                found = {
                    title: 'EASTER EGG: R√âPONSE ULTIME',
                    message: '42 - La r√©ponse √† la grande question sur la vie, l\'univers et le reste.',
                    reward: 'Achievement d√©bloqu√©: Guide du voyageur galactique'
                };
            }
            else if ((lowerQ.includes('korben') && lowerQ.includes('impressionn√©')) && !secretCommands.korben) {
                secretCommands.korben = true;
                found = {
                    title: 'EASTER EGG: MISSION ACCOMPLIE',
                    message: 'Korben serait fier de ce syst√®me ! Mission partiellement accomplie.',
                    reward: 'Badge: Approbation de Korben'
                };
            }
            else if (lowerQ.includes('ghost in the shell') && !secretCommands.ghost) {
                secretCommands.ghost = true;
                found = {
                    title: 'EASTER EGG: GHOST',
                    message: 'Le fant√¥me dans la machine veille. R√©f√©rence cyberpunk d√©tect√©e.',
                    reward: 'Th√®me Ghost d√©bloqu√©'
                };
            }
            else if (lowerQ === 'omniscient' && clearanceLevel >= 3 && !secretCommands.omniscient) {
                secretCommands.omniscient = true;
                clearanceLevel = 4;
                updateClearanceDisplay();
                found = {
                    title: 'EASTER EGG: OMNISCIENCE',
                    message: 'Clearance maximale accord√©e ! Vous avez trouv√© le code secret.',
                    reward: 'Clearance DIRECTEUR d√©bloqu√©e'
                };
            }

            if (found) {
                easterEggs++;
                document.getElementById('easterEggCounter').style.opacity = '1';
                document.getElementById('easterEggCounter').textContent = 'ü•ö ' + easterEggs;
                showEasterEggPopup(found);
                autoSave();
            }
        }

        function showEasterEggPopup(eggData) {
            const popup = document.createElement('div');
            popup.className = 'easter-egg-found';
            popup.innerHTML = `
                <h2 class="glitch-text" data-text="${eggData.title}">${eggData.title}</h2>
                <p style="margin: 20px 0;">${eggData.message}</p>
                <p style="color: var(--neon-green); font-weight: bold;">üéÅ ${eggData.reward}</p>
                <button class="btn" style="margin-top: 20px;" onclick="this.parentElement.remove()">CONTINUER</button>
            `;
            document.body.appendChild(popup);
            
            setTimeout(() => popup.remove(), 8000);
        }

        // ========== MATRIX RAIN EFFECT ==========
        function startMatrixRain() {
            const canvas = document.getElementById('matrixCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const chars = 'BiENKoRKORBEN01‚ñà‚ñì‚ñí‚ñë';
            const fontSize = 14;
            const columns = canvas.width / fontSize;
            const drops = Array(Math.floor(columns)).fill(1);

            function draw() {
                ctx.fillStyle = 'rgba(10, 14, 26, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = '#7bed9f';
                ctx.font = fontSize + 'px monospace';

                for (let i = 0; i < drops.length; i++) {
                    const text = chars[Math.floor(Math.random() * chars.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);

                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }

            setInterval(draw, 50);
        }

        // Initialize knowledge base
        function initializeKnowledgeBase() {
            // R√®gles d'√©valuation des agents
            expertSystem.addRule(
                "mission.type === 'infiltration'",
                "recommended.agent = 'Agent Shadow'; recommendation.reason = 'Expertise en op√©rations clandestines (15 ans)'",
                "Recommandation agent infiltration",
                0
            );

            expertSystem.addRule(
                "mission.type === 'cyber'",
                "recommended.agent = 'Agent Cipher'; recommendation.reason = 'Sp√©cialiste cybers√©curit√© niveau expert'",
                "Recommandation agent cyber",
                0
            );

            expertSystem.addRule(
                "analysis.type === 'threat' && threat.indicators > 3",
                "threat.level = 'CRITIQUE'; threat.details = 'Multiples indicateurs de compromission d√©tect√©s'",
                "√âvaluation menace critique",
                1
            );

            expertSystem.addRule(
                "analysis.type === 'threat' && threat.indicators <= 3",
                "threat.level = 'MOD√âR√â'; threat.details = 'Surveillance recommand√©e'",
                "√âvaluation menace mod√©r√©e",
                0
            );

            expertSystem.addRule(
                "query.type === 'trust' && agent.missions >= 10 && agent.success_rate > 0.9",
                "trust.level = '√âLEV√â'; trust.reason = 'Historique excellent'",
                "√âvaluation confiance √©lev√©e",
                1
            );

            expertSystem.addRule(
                "query.type === 'trust' && agent.missions < 10",
                "trust.level = '√Ä CONFIRMER'; trust.reason = 'Exp√©rience limit√©e'",
                "√âvaluation confiance limit√©e",
                0
            );

            // R√®gles de s√©curit√©
            expertSystem.addRule(
                "security.clearance < 2",
                "access.restricted = true; access.message = 'Clearance insuffisante'",
                "Restriction acc√®s faible clearance",
                0
            );

            // R√®gles mission Korben
            expertSystem.addRule(
                "mission.target === 'korben'",
                "mission.priority = 'MAXIMALE'; mission.approach = 'd√©monstration capacit√©s'",
                "Priorisation mission Korben",
                0
            );

            // R√®gles Agent Gardien
            expertSystem.addRule(
                "query.subject === 'creator' || query.subject === 'niveau4'",
                "guardian.intervene = true; guardian.block = true; guardian.log = 'Tentative acc√®s Niveau 4 bloqu√©e'",
                "Protection identit√© Cr√©ateur",
                3
            );

            // Faits initiaux
            expertSystem.addFact('system.status', 'operational');
            expertSystem.addFact('threat.indicators', 2);
            expertSystem.addFact('agent.missions', 12);
            expertSystem.addFact('agent.success_rate', 0.95);
            expertSystem.addFact('security.clearance', 0);
            expertSystem.addFact('mission.target', 'korben');

            updateStats();
        }

        // ========== UI FUNCTIONS ==========
        function updateStats() {
            document.getElementById('statRules').textContent = expertSystem.rules.length;
            document.getElementById('statFacts').textContent = Object.keys(expertSystem.facts).length;
            document.getElementById('statInferences').textContent = expertSystem.inferenceHistory.length;
            document.getElementById('statQueries').textContent = expertSystem.queryCount;
        }

        function displayRules() {
            const container = document.getElementById('rulesContainer');
            container.innerHTML = '';

            expertSystem.rules.forEach(rule => {
                if (rule.clearance <= clearanceLevel) {
                    const div = document.createElement('div');
                    div.className = 'rule-item';
                    div.innerHTML = `
                        <div class="rule-condition">SI: ${rule.condition}</div>
                        <div class="rule-action">ALORS: ${rule.action}</div>
                        ${rule.description ? `<div style="opacity: 0.7; margin-top: 5px;">${rule.description}</div>` : ''}
                    `;
                    container.appendChild(div);
                }
            });
        }

        function displayFacts() {
            const container = document.getElementById('factsContainer');
            container.innerHTML = '';

            for (let [key, value] of Object.entries(expertSystem.facts)) {
                const div = document.createElement('div');
                div.style.padding = '5px';
                div.style.borderBottom = '1px solid var(--border-dark)';
                div.innerHTML = `<span class="neon-text">${key}:</span> ${value}`;
                container.appendChild(div);
            }
        }

        function addChatMessage(text, type = 'system', showReasoning = null) {
            const container = document.getElementById('chatContainer');
            
            if (showReasoning && showReasoning.length > 0) {
                const reasoningDiv = document.createElement('div');
                reasoningDiv.className = 'chat-message reasoning';
                reasoningDiv.innerHTML = '<strong>‚îî‚îÄ Trace de raisonnement:</strong><br>';
                showReasoning.forEach(r => {
                    reasoningDiv.innerHTML += `‚Üí ${r.description || r}<br>`;
                });
                container.appendChild(reasoningDiv);
            }

            const div = document.createElement('div');
            div.className = `chat-message ${type}`;
            div.textContent = text;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;

            updateRecentInferences();
        }

        function updateRecentInferences() {
            const container = document.getElementById('recentInferences');
            const recent = expertSystem.inferenceHistory.slice(-5).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = '<p style="opacity: 0.5;">Aucune inf√©rence r√©cente...</p>';
                return;
            }

            container.innerHTML = '';
            recent.forEach(inf => {
                const div = document.createElement('div');
                div.className = 'graph-node fired';
                div.innerHTML = `
                    <strong>${inf.description}</strong><br>
                    <span style="opacity: 0.7; font-size: 10px;">${inf.timestamp.toLocaleTimeString()}</span>
                `;
                container.appendChild(div);
            });
        }

        function updateReasoningTrace(trace) {
            const container = document.getElementById('reasoningTrace');
            
            if (!trace || trace.length === 0) {
                container.innerHTML = '<p style="opacity: 0.5;">Le raisonnement appara√Ætra ici...</p>';
                return;
            }

            container.innerHTML = '';
            trace.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'graph-node fired';
                div.innerHTML = `
                    <strong>√âtape ${index + 1}:</strong> ${item.description || item}<br>
                    ${item.condition ? `<span style="opacity: 0.7;">Condition: ${item.condition}</span>` : ''}
                `;
                container.appendChild(div);
            });
        }

        function incrementGuardianInterventions() {
            const current = parseInt(document.getElementById('guardianInterventions').textContent);
            document.getElementById('guardianInterventions').textContent = current + 1;
            document.getElementById('guardianLastAction').textContent = 'Blocage acc√®s Niveau 4';
            document.getElementById('guardianStatus').textContent = 'ALERTE';
            document.getElementById('guardianStatus').style.color = '#ff6b6b';

            setTimeout(() => {
                document.getElementById('guardianStatus').textContent = 'ACTIF';
                document.getElementById('guardianStatus').style.color = '';
                document.getElementById('guardianLastAction').textContent = 'Surveillance';
            }, 3000);
        }

        // ========== EVENT HANDLERS ==========
        document.getElementById('querySubmit').addEventListener('click', function() {
            const input = document.getElementById('queryInput');
            const query = input.value.trim();
            
            if (!query) return;

            addChatMessage(query, 'user');
            input.value = '';

            // Check for easter eggs
            checkSecretCommand(query);

            expertSystem.reset();
            const response = expertSystem.query(query);

            addChatMessage(response.answer, 'system', response.reasoning);
            updateReasoningTrace(response.reasoning);
            updateStats();
            displayFacts();
            generateKnowledgeGraph();
            autoSave();
        });

        document.getElementById('queryInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('querySubmit').click();
            }
        });

        document.querySelectorAll('.suggestion-item').forEach(item => {
            item.addEventListener('click', function() {
                const query = this.dataset.query;
                document.getElementById('queryInput').value = query;
                document.getElementById('querySubmit').click();
            });
        });

        document.getElementById('addRuleBtn').addEventListener('click', function() {
            const condition = document.getElementById('ruleCondition').value.trim();
            const action = document.getElementById('ruleAction').value.trim();

            if (!condition || !action) {
                addChatMessage('Erreur: Condition et action requises', 'system');
                return;
            }

            if (clearanceLevel < 2) {
                addChatMessage('‚ö† Clearance SUPERVISEUR requise pour ajouter des r√®gles', 'system');
                return;
            }

            expertSystem.addRule(condition, action, 'R√®gle personnalis√©e', clearanceLevel);
            displayRules();
            updateStats();

            document.getElementById('ruleCondition').value = '';
            document.getElementById('ruleAction').value = '';

            addChatMessage('R√®gle ajout√©e avec succ√®s', 'system');
        });

        // ========== EXPORT / IMPORT ==========
        document.getElementById('exportHtmlBtn').addEventListener('click', function() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `BiENKoR_Expert_System_${new Date().toISOString().slice(0,10)}.html`;
            a.click();
            URL.revokeObjectURL(url);
            addChatMessage('‚úì Export HTML effectu√© avec succ√®s', 'system');
        });

        document.getElementById('exportMdBtn').addEventListener('click', function() {
            let markdown = `# BiENKoR EXPERT SYSTEM - RAPPORT
## Date: ${new Date().toLocaleString('fr-FR')}

---

## STATISTIQUES SYST√àME
- **R√®gles actives:** ${expertSystem.rules.length}
- **Faits connus:** ${Object.keys(expertSystem.facts).length}
- **Inf√©rences totales:** ${expertSystem.inferenceHistory.length}
- **Requ√™tes trait√©es:** ${expertSystem.queryCount}
- **Clearance actuelle:** ${clearanceLevel === 0 ? 'GUEST' : ['AGENT', 'OP√âRATEUR', 'SUPERVISEUR', 'DIRECTEUR'][clearanceLevel - 1]}

---

## BASE DE CONNAISSANCES

### R√®gles (${expertSystem.rules.length})

`;
            expertSystem.rules.forEach((rule, index) => {
                if (rule.clearance <= clearanceLevel) {
                    markdown += `#### R√®gle ${index + 1}: ${rule.description || 'Sans description'}
- **Condition:** \`${rule.condition}\`
- **Action:** \`${rule.action}\`
- **Clearance requise:** ${rule.clearance}
- **Statut:** ${rule.fired ? '‚úì D√©clench√©e' : '‚óã Non d√©clench√©e'}

`;
                } else {
                    markdown += `#### R√®gle ${index + 1}: [CLASSIFI√â]
- **Clearance insuffisante**

`;
                }
            });

            markdown += `
### Faits actuels (${Object.keys(expertSystem.facts).length})

`;
            for (let [key, value] of Object.entries(expertSystem.facts)) {
                markdown += `- **${key}:** ${value}\n`;
            }

            markdown += `
---

## HISTORIQUE DES INF√âRENCES (${expertSystem.inferenceHistory.length} derni√®res)

`;
            expertSystem.inferenceHistory.slice(-10).reverse().forEach((inf, index) => {
                markdown += `### ${index + 1}. ${inf.description}
- **Timestamp:** ${inf.timestamp.toLocaleString('fr-FR')}
- **R√®gle ID:** ${inf.rule}
- **Condition:** \`${inf.condition}\`
- **Action:** \`${inf.action}\`

`;
            });

            markdown += `
---

## HI√âRARCHIE ORGANISATIONNELLE

\`\`\`
NIVEAU 4: [CR√âATEUR] ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà (Prot√©g√© par Agent Gardien)
    ‚îÇ
    ‚îú‚îÄ NIVEAU 3: LE COLLECTIF
    ‚îÇ       ‚îÇ
    ‚îÇ       ‚îú‚îÄ NIVEAU 2: L'ORGANISATION
    ‚îÇ       ‚îÇ       ‚îÇ
    ‚îÇ       ‚îÇ       ‚îú‚îÄ NIVEAU 1: AGENTS TERRAIN
\`\`\`

---

## MISSION PRINCIPALE

**Cible:** KORBEN  
**Objectif:** D√©monstration des capacit√©s du syst√®me expert  
**Priorit√©:** MAXIMALE  
**Statut:** EN COURS

---

## AGENT GARDIEN - RAPPORT

- **Statut:** ACTIF
- **Interventions totales:** ${document.getElementById('guardianInterventions').textContent}
- **Derni√®re action:** ${document.getElementById('guardianLastAction').textContent}
- **Mission:** Protection identit√© Niveau 4 (Le Cr√©ateur)

---

*Document g√©n√©r√© par BiENKoR Expert System v2.4.7*  
*Classification: ${clearanceLevel >= 2 ? 'CONFIDENTIEL' : 'PUBLIC'}*
`;

            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `BiENKoR_Rapport_${new Date().toISOString().slice(0,10)}.md`;
            a.click();
            URL.revokeObjectURL(url);
            addChatMessage('‚úì Export Markdown effectu√© avec succ√®s', 'system');
        });

        document.getElementById('exportJsonBtn').addEventListener('click', function() {
            const exportData = {
                metadata: {
                    version: '2.4.7',
                    exportDate: new Date().toISOString(),
                    clearanceLevel: clearanceLevel,
                    statistics: {
                        totalRules: expertSystem.rules.length,
                        totalFacts: Object.keys(expertSystem.facts).length,
                        totalInferences: expertSystem.inferenceHistory.length,
                        totalQueries: expertSystem.queryCount
                    }
                },
                knowledgeBase: {
                    rules: expertSystem.rules,
                    facts: expertSystem.facts
                },
                inferenceHistory: expertSystem.inferenceHistory.slice(-50),
                guardianActivity: {
                    interventions: parseInt(document.getElementById('guardianInterventions').textContent),
                    lastAction: document.getElementById('guardianLastAction').textContent,
                    status: document.getElementById('guardianStatus').textContent
                }
            };

            const json = JSON.stringify(exportData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `BiENKoR_Knowledge_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            addChatMessage('‚úì Export JSON effectu√© avec succ√®s', 'system');
        });

        document.getElementById('importJsonBtn').addEventListener('click', function() {
            document.getElementById('importFile').click();
        });

        document.getElementById('importFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = JSON.parse(event.target.result);
                    
                    if (data.knowledgeBase) {
                        expertSystem.rules = data.knowledgeBase.rules || [];
                        expertSystem.facts = data.knowledgeBase.facts || {};
                        
                        if (data.inferenceHistory) {
                            expertSystem.inferenceHistory = data.inferenceHistory;
                        }

                        displayRules();
                        displayFacts();
                        updateStats();
                        updateRecentInferences();

                        addChatMessage('‚úì Import r√©ussi: ' + data.knowledgeBase.rules.length + ' r√®gles charg√©es', 'system');
                    } else {
                        addChatMessage('‚úó Format JSON invalide', 'system');
                    }
                } catch (error) {
                    addChatMessage('‚úó Erreur lors de l\'import: ' + error.message, 'system');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        });

        // View switching
        document.getElementById('viewDashboard').addEventListener('click', function() {
            switchView('dashboard');
        });

        document.getElementById('viewExpert').addEventListener('click', function() {
            switchView('expert');
        });

        document.getElementById('viewKnowledge').addEventListener('click', function() {
            switchView('knowledge');
            displayRules();
            displayFacts();
        });

        function switchView(view) {
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.controls .btn').forEach(b => b.classList.remove('active'));

            if (view === 'dashboard') {
                document.getElementById('dashboardView').classList.add('active');
                document.getElementById('viewDashboard').classList.add('active');
            } else if (view === 'expert') {
                document.getElementById('expertView').classList.add('active');
                document.getElementById('viewExpert').classList.add('active');
            } else if (view === 'knowledge') {
                document.getElementById('knowledgeView').classList.add('active');
                document.getElementById('viewKnowledge').classList.add('active');
            }
        }

        document.getElementById('themeToggle').addEventListener('click', function() {
            document.body.classList.toggle('light-mode');
            this.textContent = document.body.classList.contains('light-mode') ? 'MODE SOMBRE' : 'MODE CLAIR';
        });

        document.getElementById('clearanceBtn').addEventListener('click', function() {
            if (clearanceLevel < 3) {
                clearanceLevel++;
                const levels = ['AGENT', 'OP√âRATEUR', 'SUPERVISEUR', 'DIRECTEUR'];
                this.textContent = 'CLEARANCE: ' + levels[clearanceLevel - 1];
                document.getElementById('statusClearance').textContent = levels[clearanceLevel - 1];
                expertSystem.addFact('security.clearance', clearanceLevel);
                
                displayRules();
                
                if (clearanceLevel === 3) {
                    showConsole('level3');
                }
            }
        });

        // Konami code
        document.addEventListener('keydown', function(e) {
            konamiCode.push(e.key);
            if (konamiCode.length > 10) konamiCode.shift();
            
            if (konamiCode.join(',') === konamiSequence.join(',')) {
                easterEggs++;
                document.getElementById('easterEggCounter').style.opacity = '1';
                document.getElementById('easterEggCounter').textContent = 'ü•ö ' + easterEggs;
                showConsole('konami');
                konamiCode = [];
            }
        });

        document.getElementById('closeConsole').addEventListener('click', function() {
            document.getElementById('hiddenConsole').classList.remove('active');
        });

        function showConsole(type) {
            const console = document.getElementById('hiddenConsole');
            const content = document.getElementById('consoleContent');
            
            if (type === 'konami') {
                content.innerHTML = `
                    <p class="neon-text">‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó</p>
                    <p class="neon-text">‚ïë  CODE KONAMI D√âTECT√â  ‚ïë</p>
                    <p class="neon-text">‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù</p>
                    <br>
                    <p class="warning">‚ö† ALERTE AGENT GARDIEN ‚ö†</p>
                    <br>
                    <p>Tentative d'acc√®s non conventionnelle d√©tect√©e.</p>
                    <p>Analyse en cours...</p>
                    <br>
                    <p class="classified">
                    >> LOG SYST√àME <<br>
                    [${new Date().toISOString()}] S√©quence Konami initi√©e<br>
                    [${new Date().toISOString()}] Agent Gardien: √âVALUATION<br>
                    [${new Date().toISOString()}] Niveau menace: FAIBLE<br>
                    [${new Date().toISOString()}] Curiosit√© d√©tect√©e: √âLEV√âE<br>
                    </p>
                    <br>
                    <p style="color: var(--neon-purple);">R√âV√âLATION SYST√àME EXPERT:</p>
                    <p>Le moteur d'inf√©rence utilise un algorithme de cha√Ænage avant avec √©valuation dynamique des r√®gles. ${expertSystem.rules.length} r√®gles actives, ${expertSystem.inferenceHistory.length} inf√©rences effectu√©es.</p>
                    <br>
                    <p style="font-size: 11px; opacity: 0.6;">Easter Eggs trouv√©s: ${easterEggs}/7</p>
                `;
            } else if (type === 'level3') {
                content.innerHTML = `
                    <p class="neon-text">‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó</p>
                    <p class="neon-text">‚ïë  CLEARANCE SUPERVISEUR ACCORD√âE  ‚ïë</p>
                    <p class="neon-text">‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù</p>
                    <br>
                    <p><span class="neon-text">ACC√àS D√âBLOQU√â:</span> Modification base de connaissances</p>
                    <p><span class="neon-text">NOUVELLES CAPACIT√âS:</span></p>
                    <br>
                    <div class="classified">
                    <p>‚úì Ajout de r√®gles personnalis√©es</p>
                    <p>‚úì Visualisation r√®gles niveau 2</p>
                    <p>‚úì Export/Import base de connaissances</p>
                    <p>‚úó Acc√®s identit√© Cr√©ateur (NIVEAU 4 requis)</p>
                    </div>
                    <br>
                    <p class="warning">‚ö† AVERTISSEMENT ‚ö†</p>
                    <p style="font-size: 11px;">L'Agent Gardien surveille toute tentative d'acc√®s au Niveau 4.</p>
                    <br>
                    <p style="font-size: 10px; opacity: 0.5;">Note: Mission Korben - Le syst√®me expert est maintenant pleinement op√©rationnel</p>
                `;
            }
            
            console.classList.add('active');
        }

        // ========== BOOT SEQUENCE ==========
        const bootSequence = [
            'INITIALISATION BiENKoR EXPERT SYSTEM v2.4.7...',
            'Chargement modules de s√©curit√©...',
            'V√©rification int√©grit√© syst√®me... OK',
            'Chargement moteur d\'inf√©rence...',
            '> Algorithme de cha√Ænage: ACTIF',
            '> Pattern matching: ACTIF',
            '> √âvaluation r√®gles: ACTIF',
            'Chargement base de connaissances...',
            '> R√®gles m√©tier: CHARG√âES',
            '> Faits initiaux: CHARG√âS',
            '> Ontologie: CHARG√âE',
            'V√©rification Agent Gardien...',
            '> Agent Gardien: ACTIF',
            '> Protection niveau 4: ACTIVE',
            'Initialisation interface utilisateur...',
            'V√©rification clearance utilisateur...',
            'Clearance d√©tect√©e: GUEST',
            '> Module Dashboard: CHARG√â',
            '> Module Expert: CHARG√â',
            '> Module Connaissances: ACC√àS LIMIT√â',
            'Activation mission KORBEN...',
            'Tous les syst√®mes op√©rationnels.',
            'Bienvenue dans BiENKoR EXPERT SYSTEM.',
            ''
        ];

        function bootSystem() {
            const bootContent = document.getElementById('bootContent');
            let delay = 0;

            bootSequence.forEach((line, index) => {
                setTimeout(() => {
                    const lineDiv = document.createElement('div');
                    lineDiv.className = 'terminal-line';
                    lineDiv.textContent = line;
                    bootContent.appendChild(lineDiv);
                    
                    if (index === bootSequence.length - 1) {
                        setTimeout(() => {
                            const cursor = document.createElement('span');
                            cursor.className = 'cursor';
                            bootContent.appendChild(cursor);
                            
                            setTimeout(() => {
                                document.getElementById('bootScreen').classList.add('hidden');
                                document.getElementById('mainInterface').classList.add('active');
                                initializeKnowledgeBase();
                            }, 1000);
                        }, 500);
                    }
                    
                    bootContent.scrollTop = bootContent.scrollHeight;
                }, delay);
                delay += 150;
            });
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('fr-FR');
        }

        setInterval(updateTime, 1000);
        updateTime();
        
        // Try to load autosaved data
        loadAutoSave().then(loaded => {
            if (loaded) {
                console.log('Autosave loaded successfully');
            }
            bootSystem();
        });

        // Auto-save every 30 seconds
        autoSaveInterval = setInterval(autoSave, 30000);

        // Additional easter eggs
        let clickCount = 0;
        document.querySelector('.logo').addEventListener('click', function() {
            clickCount++;
            if (clickCount >= 7 && !secretCommands.guardian) {
                secretCommands.guardian = true;
                easterEggs++;
                document.getElementById('easterEggCounter').style.opacity = '1';
                document.getElementById('easterEggCounter').textContent = 'ü•ö ' + easterEggs;
                showEasterEggPopup({
                    title: 'EASTER EGG: PERSISTANCE',
                    message: 'Vous avez cliqu√© 7 fois sur le logo ! L\'Agent Gardien appr√©cie votre d√©termination.',
                    reward: 'Badge: Chercheur de secrets'
                });
                clickCount = 0;
            }
        });

        // Secret double-click on panels
        document.querySelectorAll('.panel').forEach(panel => {
            panel.addEventListener('dblclick', function() {
                const badge = this.querySelector('.clearance-badge');
                if (badge && (badge.textContent === 'SECRET' || badge.textContent === 'CONFIDENTIEL')) {
                    if (Math.random() < 0.3) { // 30% chance
                        easterEggs++;
                        document.getElementById('easterEggCounter').style.opacity = '1';
                        document.getElementById('easterEggCounter').textContent = 'ü•ö ' + easterEggs;
                    }
                }
            });
        });
    </script>
</body>
</html>
